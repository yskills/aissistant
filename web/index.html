<!doctype html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luna Assistant Dev UI</title>
  <link rel="stylesheet" href="./styles.css" />
  <script src="./app.js" defer></script>
</head>
<body>
  <section class="infra-status-board" aria-live="polite">
    <div class="infra-card">
      <div class="infra-head">
        <span class="infra-title">Core Server</span>
        <span id="serverSpinner" class="infra-spinner"></span>
      </div>
      <div id="serverStatus" class="infra-value">prüfe ...</div>
      <div id="serverDetail" class="infra-detail">Warte auf Health-Check</div>
    </div>
    <div class="infra-card">
      <div class="infra-head">
        <span class="infra-title">GPU-ML Trainer</span>
        <span id="gpuSpinner" class="infra-spinner"></span>
      </div>
      <div id="gpuStatus" class="infra-value">prüfe ...</div>
      <div id="gpuDetail" class="infra-detail">Warte auf Provider-Check</div>
    </div>
  </section>

  <button id="fab" class="assistant-fab" aria-label="Assistant öffnen">×</button>

  <aside id="panel" class="panel open" role="dialog" aria-modal="false">
    <div class="panel-head">
      <div class="assistant-title">
        <button id="avatarBtn" class="avatar" title="Charakter wählen">L</button>
        <div class="assistant-meta">
          <h2 id="charName">Luna</h2>
          <div id="llmStatus" class="status">Lade Status ...</div>
        </div>
      </div>
      <div class="head-actions">
        <button id="settingsToggle" class="icon-btn" title="Settings">⚙</button>
        <button id="closeBtn" class="icon-btn" title="Schließen">×</button>
      </div>
    </div>

    <div class="panel-tabs">
      <div class="tabs">
        <button id="tabChat" class="tab active">Chat</button>
        <button id="tabSettings" class="tab">Settings</button>
      </div>
      <button id="modeToggle" class="chip-btn mode-toggle">○ normal</button>
    </div>

    <div class="panel-body">
      <section id="chatView" class="chat-view active">
        <div id="chatScroll" class="chat-scroll"></div>
        <div class="panel-foot">
          <textarea id="chatInput" placeholder="Schreib hier..." rows="1"></textarea>
          <button id="sendBtn" class="send-btn" title="Senden">→</button>
        </div>
      </section>

      <section id="settingsView" class="settings-view">
        <div class="settings-scroll">
          <div class="settings-section" style="padding:8px 8px 10px;border-radius:12px;">
            <p class="section-title">Assistant Settings / Memory Admin</p>
            <div class="overview">
              <div class="ov-card"><strong id="ovHist">0</strong><span>History</span></div>
              <div class="ov-card"><strong id="ovUnc">0</strong><span>Uncensored</span></div>
              <div class="ov-card"><strong id="ovMem">0</strong><span>Memories</span></div>
              <div class="ov-card"><strong id="ovMode">normal</strong><span>Mode</span></div>
            </div>

            <div class="settings-actions">
              <button id="btnEnsureTrainer" class="soft">Trainer starten</button>
              <button id="btnExampleAdapter" class="primary">Example Adapter</button>
              <button id="btnReset" class="danger">Complete Reset</button>
              <button id="btnRefresh" class="soft">Refresh Settings</button>
            </div>

            <div class="line">
              <label style="font-size:12px;color:var(--txt-dim)">minCurated</label>
              <input id="minCurated" type="number" value="20" />
            </div>

            <div class="line">
              <button id="btnDeleteDay" class="soft" style="flex:1;">Tag löschen</button>
              <button id="btnDelete7Days" class="soft" style="flex:1;">7 Tage löschen</button>
              <button id="btnDeleteMonth" class="soft" style="flex:1;">Monat löschen</button>
            </div>
          </div>

          <div class="status-line" id="adapterPathOut"></div>
          <div class="status-line" id="adapterHintOut"></div>

          <div class="settings-section api-explorer">
            <p class="section-title">API Explorer</p>
            <div class="line">
              <input id="apiEndpoint" type="text" value="/training/status?minCurated=20" placeholder="/mode?characterId=luna" />
            </div>
            <div class="line">
              <span id="apiMethod" class="api-method">GET</span>
              <button id="btnRunApi" class="soft" style="flex:1;">Endpoint ausführen</button>
            </div>
            <textarea id="apiPayload" class="api-payload" rows="5" placeholder='{"characterId":"luna"}'></textarea>
            <p class="api-hint">Für GET bleibt Payload leer. Für POST/PUT JSON einfügen.</p>
          </div>

          <div class="status-line" id="opsOut"></div>
        </div>
      </section>
    </div>
  </aside>

  <div id="overlay" class="overlay" role="dialog" aria-modal="true">
    <div class="char-modal">
      <h3 style="margin:0 0 10px;">Charakter auswählen</h3>
      <div id="charGrid" class="char-grid"></div>
      <div style="display:flex;justify-content:flex-end;margin-top:10px;">
        <button id="closeOverlay" class="icon-btn">Schließen</button>
      </div>
    </div>
  </div>
</body>
</html>
